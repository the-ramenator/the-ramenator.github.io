<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <!-- <base href="https://the-ramenator.github.io/" /> -->
        <link rel="icon" type="image/png" href="assets/homepage/favicon.png" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Bitcount+Grid+Single:wght@100..900&family=Doto:wght@100..900&family=Google+Sans+Code:ital,wght@0,300..800;1,300..800&family=Roboto+Slab:wght@100..900&display=swap" rel="stylesheet">

        <title>Collatz Conjecture Over Under</title>
        <style>
            :root{
                --green: #7ed957;
                --whiteGreen: #C3FFAB;
                --greenDark: #5FA641;
                --red: #ff3131;
                --whiteRed: #FFA3A3;
                --black: rgb(30,30,30);
                --orange: #ff914d;
                --blue: #38b6ff;

                --delay: 0.5s;
                --duration: 1s;

                --doto: "Doto", sans-serif;
                --bitcount: "Bitcount Grid Single", system-ui;
                --roboto: "Roboto Slab", serif;
                --mono: "Google Sans Code", monospace;
            }
            *{
                margin: 0;
                padding: 0;
                transition: 0.5s;
                user-select: none;
            }
            body{
                overflow: hidden;
                background: var(--black);
                color: white;
            }
            input::-webkit-outer-spin-button,
            input::-webkit-inner-spin-button {
                -webkit-appearance: none;
                margin: 0;
            }
            input[type="number"] {
                -moz-appearance: textfield;
            }
            .title{
                position: absolute;
                font-family: var(--roboto);
                font-size: 3.5em;
                position: absolute;
                top: 25%;
                left: 50%;
                transform: translate(-50%,-50%);
                animation: disappearTitle var(--duration) ease-in-out;
                animation-delay: var(--delay);
                animation-fill-mode: forwards;
            }
            @keyframes disappearTitle{
                from{
                    opacity: 1;
                    transform: translate(-50%,-50%);
                }
                to{
                    opacity: 0;
                    font-size: 3.25em;
                    transform: translate(-50%,-200%);
                    display: none;
                }
            }
            #over, #under, #slash{
                background: none;
                border: none;
                font-family: var(--bitcount);
                font-size: 5em;
            }
            #over{
                color: var(--green);
                cursor: pointer;
            }
            #under{
                color: var(--red);
                cursor: pointer;
            }
            #over:hover{
                text-shadow: 0 0 20px var(--green);
                color: var(--whiteGreen);
            }
            #under:hover{
                text-shadow: 0 0 20px var(--red);
                color: var(--whiteRed);
            }
            #options{
                position: absolute;
                display: flex;
                justify-content: center;
                width: 0%;
                animation: spaceOptions var(--duration) ease-in-out;
                animation-delay: var(--delay);
                animation-fill-mode: forwards;
                top: 50%;
                left: 50%;
                transform: translate(-50%,-50%);
            }
            @keyframes spaceOptions{
                from{
                    gap: 0em;
                    top: 50%;
                }
                to{
                    gap: 5em;
                    top: 70%;
                }
            }
            #info{
                opacity: 0;
                animation: displayInfo var(--duration) ease-in-out;
                animation-delay: 1s;
                animation-fill-mode: forwards;
            }
            @keyframes displayInfo{
                from{
                    opacity: 0;
                }
                to{
                    opacity: 1;
                }
            }
            #n:focus{
                outline: none;
                border-bottom: 2px solid white;
            }
            .nValue{
                position: absolute;
                display: flex;
                justify-content: center;
                top: 30%;
                left: 50%;
                transform: translate(-50%,-50%);
                align-items: center
            }
            #n{
                transition: 0.1s;
                background: transparent;
                border-top: none;
                border-left: none;
                border-right: none;
                border-bottom: 1px solid white;
                color: white;
                font-size: 5em;
                margin-right: 0.5em;
                font-family: var(--mono);
            }
            #random{
                font-size: 3.5em;
                cursor: pointer;
            }
            #random:hover{
                color: rgb(150,150,150);
            }
            #convergeGuess{
                position: absolute;
                display: flex;
                justify-content: center;
                top: 42.5%;
                left: 50%;
                transform: translate(-50%,-50%);
                font-family: var(--mono);
                font-size: 1.5em;
            }
            .convergeGuessN{
                color: var(--orange);
            }
            #runCounter{
                position: absolute;
                top: 30%;
                left: 50%;
                transform: translate(-50%,-50%);
                font-family: var(--mono);
                font-size: 2em;
            }
            #youPicked{
                position: absolute;
                top: 80%;
                left: 50%;
                transform: translate(-50%,-50%);
                font-family: var(--mono);
                font-size: 1.25em;
                width: 100%;
                text-align: center;
            }
            #score{
                position: absolute;
                top: 0%;
                right: 0%;
                font-family: var(--mono);
                font-size: 1.5em;
                margin: 3em;
                text-align: right
            }
            #skip{
                position: absolute;
                bottom: 0%;
                right: 0%;
                font-family: var(--mono);
                font-size: 3em;
                margin: 2em;
                cursor: pointer;
            }
            #skip:hover{
                color: rgb(150,150,150);
            }
            #valContContainer{
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%,-50%);
                font-family: var(--mono);
                font-size: 5em;
                width: 50%;
                height: 2em;
                overflow: scroll;
                scrollbar-width: none;
            }
            #valContContainer::-webkit-scrollbar {
                display: none;
            }
            #leftBorder{
                background-blend-mode: overlay;
                background-image:
                    linear-gradient(90deg, rgba(30, 30, 30, 1) 0%, rgba(30, 30, 30, 1) 30%, rgba(30, 30, 30, 0) 100%),
                    url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGNgYAAAAAMAASsJTYQAAAAASUVORK5CYII=");
                width: 20%;
                height: 10em;
                position: absolute;
                top: 50%;
                left: 34%;
                transform: translate(-50%,-50%);
            }
            #rightBorder{
                background-blend-mode: overlay;
                background-image:
                    linear-gradient(270deg, rgba(30, 30, 30, 1) 0%, rgba(30, 30, 30, 1) 30%, rgba(30, 30, 30, 0) 100%),
                    url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGNgYAAAAAMAASsJTYQAAAAASUVORK5CYII=");
                width: 20%;
                height: 10em;
                position: absolute;
                top: 50%;
                left: 66%;
                transform: translate(-50%,-50%);
            }
            #valCont span{
                /* border: 1px solid white; */
            }
            .key{
                position: absolute;
                color: white;
                bottom: 0%;
                left: 0%;
                margin: 2em 3em;
                font-family: var(--doto);
                font-size: 1.5em;
                font-weight: bold;
            }
            .greenBox{
                width: 30px;
                height: 30px;
                border-radius: 10px;
                background: var(--whiteGreen);
            }
            .redBox{
                width: 30px;
                height: 30px;
                border-radius: 10px;
                background: var(--whiteRed);
            }
            .greenBoxCont,.redBoxCont{
                display: flex;
                gap: 1em;
                margin-bottom: 1em;
            }
            .scorespan{
                font-family: var(--mono);
                font-size: 2em;
            }

            #infoBtn{
                color: var(--green);
                margin: 2em;
                width: 50px;
                height: 50px;
                font-size: 2em;
                border: 3px solid var(--green);
                border-radius: 50%;
                position: absolute;
                top: 0;
                left: 0;
                cursor: pointer;
            }
            #infoBtn i{
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%,-50%);
            }
            #infoBtn:hover{
                color: var(--greenDark);
                border: 3px solid var(--greenDark);
            }
            .modal {
                display: none;
                position: fixed;
                z-index: 1;
                padding-top: 100px;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                overflow: auto;
                background-color: rgba(0,0,0,0.7);
            }

            .modal-content {
                position: relative;
                background-color: var(--black);
                margin: auto;
                padding: 0;
                width: 50%;
                box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
                -webkit-animation-name: animatetop;
                -webkit-animation-duration: 0.4s;
                animation-name: animatetop;
                animation-duration: 0.4s;
                padding: 3em;
                border-radius: 16px;
            }
            .modal-content h1{
                font-family: var(--doto);
                margin-bottom: 0.5em;
                font-size: 2.5em;
                font-weight: bold;
            }
            .modal-content p{
                font-family: var(--roboto); 
            }

            .modal-content li{
                font-family: var(--roboto);
                margin-bottom: 0.3em;
            }

            /* Add Animation */
            @-webkit-keyframes animatetop {
                from {top:-300px; opacity:0} 
                to {top:0; opacity:1}
            }

            @keyframes animatetop {
                from {top:-300px; opacity:0}
                to {top:0; opacity:1}
            }

            /* The Close Button */
            .close {
                color: white;
                float: right;
                font-size: 2.5em;
                font-weight: bold;
            }

            .close:hover,
            .close:focus {
                color: var(--whiteGreen);
                text-decoration: none;
                cursor: pointer;
            }



            .blobGroup {
                position: absolute;
                transform: translate(-50%, -50%);
            }

            .blob {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                border-radius: 50%;
                background: transparent;
                border: 2px solid rgba(255,255,255,0.6);
                opacity: 0.5;
            }

            /* Blob Animations */
            .blob1 { animation: morph1 8s ease-in-out infinite; }
            .blob2 { animation: morph2 10s ease-in-out infinite; }
            .blob3 { animation: morph3 12s ease-in-out infinite; }
            .blob4 { animation: morph4 14s ease-in-out infinite; }
            .blob5 { animation: morph5 16s ease-in-out infinite; }

            /* Morph Variants */
            @keyframes morph1 {
                0%, 100% { border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%; }
                50% { border-radius: 40% 60% 70% 30% / 50% 60% 40% 70%; }
            }
            @keyframes morph2 {
                0%, 100% { border-radius: 70% 30% 50% 50% / 40% 60% 60% 40%; }
                50% { border-radius: 50% 50% 30% 70% / 60% 40% 70% 30%; }
            }
            @keyframes morph3 {
                0%, 100% { border-radius: 55% 45% 65% 35% / 40% 50% 60% 50%; }
                50% { border-radius: 45% 55% 35% 65% / 60% 40% 50% 60%; }
            }
            @keyframes morph4 {
                0%, 100% { border-radius: 68% 32% 42% 58% / 48% 52% 58% 42%; }
                50% { border-radius: 38% 62% 62% 38% / 68% 32% 42% 58%; }
            }
            @keyframes morph5 {
                0%, 100% { border-radius: 64% 36% 52% 48% / 38% 72% 28% 62%; }
                50% { border-radius: 46% 54% 64% 36% / 62% 38% 72% 28%; }
            }

        </style>
    </head>
    <body>
        <div id="infoBtn"><i class="fa-solid fa-info"></i></div>

        <div id="infoModal" class="modal">

            <div class="modal-content">
                <span class="close">&times;</span>
                <h1 style='color: #FFA3A3;'>What's the Collatz Conjecture?</h1>
                <ul>
                    <li>Take any number N</li>
                    <li>If N is even, divide by 2</li>
                    <li>If N is odd, multiply by 3 and add 1. </li>
                </ul>
                <p>Interestingly, every N tested converges on 1, since 4, 2, 1 repeats infinitely.</p>

                <h1 style='color: #C3FFAB; margin-top: 1.5em;'>How to play</h1>
                <ol>
                    <li>Type an N value, or randomly generate one</li>
                    <li>Guess whether n will take above or below the number of terms the computer provides to reach 1</li>
                    <li>Watch the sequence play out and see if the guess was right</li>
                </ol>
            </div>

        </div>

        <span id='score'>Score: 0</span>
        <div id='baseCont'>
            <div id='introCont'>
                <span class='title'>Collatz Conjecture</span>
            </div>
            <div id='baseContainer'>
                <div id='options'>
                    <button id='over'>Over</button>
                    <span id='slash'>/</span>
                    <button id='under'>Under</button>
                </div>
                <div id='info'>
                    <div class='nValue'>
                        <input id='n' type='number'>
                        <i id='random' class="fa-solid fa-shuffle"></i>
                    </div>
                    <span id='convergeGuess'>X terms to convege</span>
                </div>
            </div>
        </div>
        <div id='runCont'>
            <span id='runCounter'>Terms: 0</span>
            <div id='valContContainer'>
                <div id='valCont'></div>
            </div>
            <div id='leftBorder'></div>
            <div id='rightBorder'></div>
            <span id='youPicked'></span>
            <span id='skip'><i class="fa-solid fa-forward"></i></span>
            <div class='key'>
                <div class='greenBoxCont'>
                    <div class='greenBox'></div>
                    n/2
                </div>
                <div class='redBoxCont'>
                    <div class='redBox'></div>
                    3n+1
                </div>
            </div>
        </div>
        <div class="blobs">
            <div class="blobGroup blob1Cont" style="top:10%; left:35%;">
                <div class="blob blob1" style="width:220px; height:220px;"></div>
                <div class="blob blob1" style="width:170px; height:170px;"></div>
                <div class="blob blob1" style="width:120px; height:120px;"></div>
                <div class="blob blob1" style="width:80px; height:80px;"></div>
            </div>

            <div class="blobGroup blob2Cont" style="top:85%; left:80%;">
                <div class="blob blob2" style="width:160px; height:160px;"></div>
                <div class="blob blob2" style="width:120px; height:120px;"></div>
                <div class="blob blob2" style="width:90px; height:90px;"></div>
                <div class="blob blob2" style="width:60px; height:60px;"></div>
            </div>

            <div class="blobGroup blob3Cont" style="top:30%; left:85%;">
                <div class="blob blob3" style="width:260px; height:260px;"></div>
                <div class="blob blob3" style="width:210px; height:210px;"></div>
                <div class="blob blob3" style="width:150px; height:150px;"></div>
                <div class="blob blob3" style="width:100px; height:100px;"></div>
            </div>

            <div class="blobGroup blob4Cont" style="top:80%; left:15%;">
                <div class="blob blob4" style="width:200px; height:200px;"></div>
                <div class="blob blob4" style="width:150px; height:150px;"></div>
                <div class="blob blob4" style="width:100px; height:100px;"></div>
                <div class="blob blob4" style="width:60px; height:60px;"></div>
            </div>

            <div class="blobGroup blob5Cont" style="top:30%; left:2%;">
                <div class="blob blob5" style="width:180px; height:180px;"></div>
                <div class="blob blob5" style="width:130px; height:130px;"></div>
                <div class="blob blob5" style="width:90px; height:90px;"></div>
                <div class="blob blob5" style="width:50px; height:50px;"></div>
            </div>
        </div>


        <script>
            function random(min,max){
                return (Math.random()*(max-min)+min).toFixed(0);
            }
            function collatz(n){
                let list = [];
                list.push(n);
                while(n != 1){
                    if(n%2 == 0){
                        n = n/2;
                    }
                    else{
                        n = n*3+1;
                    }
                    list.push(n);
                }
                return list;
            }
            let values = [];
            let overUnderBound = 0;
            function createCollatz(n){
                values = collatz(n);
                overUnderBound = random(0.5*values.length,1.5*values.length);
                while(overUnderBound == values.length){
                    overUnderBound = random(0.5*values.length,1.5*values.length);
                }
                let nDisplay = document.getElementById('n');
                nDisplay.value = n;
                nDisplay.style.width = nDisplay.value.length + "ch";
                document.getElementById('convergeGuess').innerHTML = "<span class='convergeGuessN'>"+overUnderBound+"</span>&nbsp;terms to converge";  
            }

            // document.getElementById('demo').innerHTML = collatz(22);
            document.getElementById('random').addEventListener('click', function(){
                let newCollatz = random(4,1000);
                createCollatz(newCollatz);
            });
            document.getElementById('random').click();
            let oldInputValue;
            document.getElementById('n').addEventListener('focus', function(){
                oldInputValue = document.getElementById('n').value;
            });
            document.getElementById('n').addEventListener('blur', function(){
                if(this.value == '' || this.value == 0){
                    createCollatz(random(4,1000));
                }
                else if(oldInputValue != document.getElementById('n').value){
                    createCollatz(document.getElementById('n').value);
                }
            });
            document.getElementById('n').addEventListener('input', function(event) {
                this.style.width = this.value.length + "ch";
                if (event.key === 'Enter' && oldInputValue != this.value) {
                    oldInputValue = this.value;
                    createCollatz(oldInputValue);
                }
            });

            let score;
            if(localStorage.getItem('collatzScore')){
                score = parseInt(localStorage.getItem('collatzScore'));
                document.getElementById('score').innerHTML = 'Score: '+score;
            }
            else{
                score = 0;
            }
            document.getElementById('over').addEventListener('click', function(){
                runCollatz(values,true,overUnderBound);
            });
            document.getElementById('under').addEventListener('click', function(){
                runCollatz(values,false,overUnderBound);
            });

            document.getElementById('runCont').style.opacity = 0;
            document.getElementById('runCont').style.display = 'none';

            let didSkip = false;
            document.getElementById('skip').addEventListener('click', function(){
                didSkip = true;
            });
            function runCollatz(list, choseOver,bound){
                let counter = 0;
                let runCounter = document.getElementById('runCounter');
                const valCont = document.getElementById('valCont');
                let scrollAmounts = [];
                document.getElementById('baseCont').style.opacity = 0;
                document.getElementById('runCont').style.display = 'block';
                document.getElementById('runCont').style.opacity = 1;
                for(let i = 0; i < list.length; i++){
                    let span = document.createElement('span');
                    if(list[i] %2 == 0){
                        span.style.color = '#C3FFAB'; //7ed957
                    }
                    else{
                        span.style.color = '#FFA3A3'; //ff3131
                    }
                    /* if(i == 0){
                        // span.innerHTML += '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
                    }*/
                    span.innerHTML += list[i] + '&nbsp;&nbsp;';
                    /*if(list[i] == 1){
                     span.innerHTML += '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
                    }*/
                    let colorVal = 255;
                    // span.style.color = 'rgba('+colorVal+','+colorVal+','+colorVal+')';
                    valCont.append(span);
                    scrollAmounts.push(span.getBoundingClientRect().width);
                }
                valCont.innerHTML += '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';

                const valContContainer = document.getElementById('valContContainer');
                valCont.style.transform = 'translate('+(valCont.getBoundingClientRect().width/2-scrollAmounts[0]/2)+'px,0%)';
                if(choseOver){
                    document.getElementById('youPicked').innerHTML = 'You picked <span style="color: #7ed957">over</span> '+bound+ ' terms for <span style="color: #38b6ff">'+document.getElementById('n').value+'</span> to converge to 1';
                }
                else{
                    document.getElementById('youPicked').innerHTML = 'You picked <span style="color: #ff3131">under</span> '+bound+ ' terms for <span style="color: #38b6ff">'+document.getElementById('n').value+'</span> to converge to 1';
                }

                valContContainer?.addEventListener("wheel",function(e) {
                    e.preventDefault();
                }, { passive: false });


                setTimeout(function(){
                    console.log(list.length);
                    let interval = setInterval(function(){
                        if(counter < list.length){
                            if(!didSkip){
                                console.log(list[counter]);
                                runCounter.innerText = "Terms: "+counter;
                                if(counter > 0){
                                    valContContainer.scrollBy({
                                        left: scrollAmounts[counter],
                                        behavior: 'smooth'
                                    });
                                }
                                /*if(list[counter] == 1){
                                setTimeout(function(){
                                    valContContainer.scrollBy({
                                        left: 300,
                                        behavior: 'smooth'
                                    });
                                },1000);
                            }*/
                                counter ++;
                            }
                            else{
                                didSkip = false;
                                counter = list.length;
                                runCounter.innerText = "Terms: "+counter;
                                const scrollTotal = scrollAmounts.reduce((accumulator, currentValue) => accumulator + currentValue, 0);
                                valContContainer.scrollBy({
                                    left: scrollTotal,
                                    behavior: 'smooth'
                                });
                            }
                        }
                        else{
                            let scoreSpan = document.createElement('span');
                            scoreSpan.style.position = 'absolute';
                            scoreSpan.style.right = '3em';
                            scoreSpan.style.top = '5em';
                            scoreSpan.classList.add('scorespan');
                            scoreSpan.style.opacity = 0;
                            document.getElementById('runCont').append(scoreSpan);
                            scoreSpan.style.opacity = 1;

                            clearInterval(interval);
                            if(choseOver && bound < list.length){
                                score++;
                                scoreSpan.style.color = "#C3FFAB";
                                scoreSpan.innerHTML = "+1";
                            }
                            else if(choseOver == false && bound > list.length){
                                score++;
                                scoreSpan.style.color = "#C3FFAB";
                                scoreSpan.innerHTML = "+1";
                            }
                            else if(bound == list.length){
                                score++;
                                scoreSpan.style.color = "#C3FFAB";
                                scoreSpan.innerHTML = "+1";
                            }
                            else{
                                score--;
                                scoreSpan.style.color = "#FFA3A3";
                                scoreSpan.innerHTML = "-1";
                            }
                            localStorage.setItem('collatzScore',score);
                            setTimeout(function(){
                                scoreSpan.style.opacity = 0;
                                scoreSpan.style.transform = 'translate(0,-2em)';
                            },300);
                            setTimeout(function(){
                                document.getElementById('score').innerText = 'Score: '+score;
                                scoreSpan.remove();
                            },500);
                            setTimeout(function(){
                                document.getElementById('baseCont').style.display = 'block';
                                document.getElementById('baseCont').style.opacity = 1;
                                document.getElementById('runCont').style.opacity = 0;
                            },2500);
                            setTimeout(function(){
                                document.getElementById('runCont').style.display = 'none';
                                valCont.innerHTML = '';
                                valCont.style.transform = 'translate(0,0)';
                                createCollatz(random(4,1000));
                            },3000);

                        }
                    }, 500);
                },1000);
            }
            var modal = document.getElementById("infoModal");
            var btn = document.getElementById("infoBtn");
            var close = document.getElementsByClassName("close")[0];
            btn.onclick = function() {
                modal.style.display = "block";
            }
            close.onclick = function() {
                modal.style.display = "none";
            }
            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }

        </script>
        <script src="https://kit.fontawesome.com/ba992eac8c.js" crossorigin="anonymous"></script>
    </body>
</html>
